<html>
<body>
  <div>
    S N A K E
    </br>
    Use arrow keys to navigate and gobble up the bits
  </div>
  </br>
  <canvas id="game" width="300" height="200"></canvas>
  <div> Score: <div id="score">0</div></div>
  <div id="speed"></div>
    <input type="range" id="slider" min=1 max=6 value=2></input>
    <button id="submitSpeed">Set Speed</button>
    </br>
    OR
    </br>
    <button value=200 id="easy">EASY</button>
    <button value=130 id="medium">MEDIUM</button>
    <button value=90 id="hard">HARD</button>
    <button value=50 id="ludicrous">LUDICROUS</button>
    <button value=20 id="no">no.</button>
    <button value=10 id="y">y thooo</button>
    <button value=1 id="y">impossible</button>
  </div>

  <script>
  //draw board
  var canvas = document.getElementById('game');
  var ctx = canvas.getContext('2d');
  var heightPixels = 200;
  var widthPixels = 300;
  var segmentHeight = 10;
  var segmentWidth = 10;
  var gameHeight = heightPixels/segmentHeight;
  var gameWidth = widthPixels/segmentWidth;

  //starting game state
  var velocity = [-segmentWidth, 0];
  nextMove = [[velocity[0], velocity[1]]];
  var bodyArr = [[
    Math.floor(Math.random()*segmentWidth)*gameWidth,
    Math.floor(Math.random()*segmentHeight)*gameHeight,
    segmentWidth,
    segmentHeight
  ]];
  var dot = [
    Math.floor(Math.random()*segmentWidth)*gameWidth,
    Math.floor(Math.random()*segmentHeight)*gameHeight,
    segmentWidth,
    segmentHeight
  ];
  var speed = 150;
  var score = 0;

  var changeDirection = function(e){
    console.log(e.key);
    if (e.key === 'ArrowLeft' && velocity[0] !== segmentWidth) {
      velocity = [-segmentWidth, 0];
      nextMove.push(velocity);
    } else if (e.key === 'ArrowDown' && velocity[1] !== -segmentHeight) {
      velocity = [0, segmentHeight];
      nextMove.push(velocity);
    } else if (e.key === 'ArrowRight' && velocity[0] !== -segmentWidth) {
      velocity = [segmentWidth, 0];
      nextMove.push(velocity);
    } else if (e.key === 'ArrowUp' && velocity[1] !== segmentHeight) {
      velocity = [0, -segmentHeight];
      nextMove.push(velocity);
    }
  }

  var changeSpeed = function (e) {
    speed = parseInt(e.target.value, 10);
    clearInterval(nextFrame);
    nextFrame = setInterval(() => {
      moveSnake();
      checkEaten();
      checkLost();
      checkWin();
      render()
    }, speed)
  }

  var submitSpeed = function (e) {
    speed = 300/(document.getElementById("slider").value);
    clearInterval(nextFrame);
    nextFrame = setInterval(() => {
      moveSnake();
      checkEaten();
      checkLost();
      checkWin();
      render()
    }, speed)
  }

  window.addEventListener('keydown', changeDirection, false);
  var submitSpeedButton = document.getElementById("submitSpeed").addEventListener('click', submitSpeed, false);

  var buttonArray = document.getElementsByTagName('button');
  Array.prototype.forEach.call(buttonArray, (speedButton) => {
    if(speedButton.id !== "submitSpeed") {
      speedButton.addEventListener('click', changeSpeed, false);
    }
  })

  var render = function () {
    ctx.clearRect(0, 0, widthPixels, heightPixels);
    bodyArr.forEach((segment) => {ctx.fillRect(...segment)});
    ctx.fillRect(...dot);
  }

  var updateDot = function () {
    dot = [
      Math.floor(Math.random()*segmentWidth)*gameWidth,
      Math.floor(Math.random()*segmentHeight)*gameHeight,
      segmentWidth,
      segmentHeight
    ];
    //check that the dot isn't on the snake and move it if it is
    bodyArr.forEach((segment) => {
      if(segment[0] === dot[0] && segment[1] === dot[1]) {
        updateDot();
      }
    })
  }

  var moveSnake = function () {
    if(bodyArr[0][0]+nextMove[0][0] >= widthPixels) {
      bodyArr.unshift([0, bodyArr[0][1] + nextMove[0][1], segmentWidth, segmentHeight]);
      if (nextMove.length > 1) {
        nextMove = nextMove.slice(1, nextMove.length);
      }
    } else if (bodyArr[0][0]+nextMove[0][0] < 0) {
      bodyArr.unshift([widthPixels, bodyArr[0][1] + nextMove[0][1], segmentWidth, segmentHeight]);
      if (nextMove.length > 1) {
        nextMove = nextMove.slice(1, nextMove.length);
      }
    } else if (bodyArr[0][1] + nextMove[0][1] >= heightPixels) {
      bodyArr.unshift([bodyArr[0][0] + nextMove[0][0], 0, segmentWidth, segmentHeight]);
      if (nextMove.length > 1) {
        nextMove = nextMove.slice(1, nextMove.length);
      }
    } else if (bodyArr[0][1] + nextMove[0][1] < 0) {
      bodyArr.unshift([bodyArr[0][0] + nextMove[0][0], heightPixels, segmentWidth, segmentHeight]);
      if (nextMove.length > 1) {
        nextMove = nextMove.slice(1, nextMove.length);
      }
    } else {
      bodyArr.unshift([bodyArr[0][0] + nextMove[0][0], bodyArr[0][1] + nextMove[0][1], segmentWidth, segmentHeight]);
      if (nextMove.length > 1) {
        nextMove = nextMove.slice(1, nextMove.length);
      }
    }
  }

  var checkEaten = function () {
    if(bodyArr[0][0] === dot[0] && bodyArr[0][1] === dot[1]) {
      updateDot();
      bodyArr = bodyArr.slice(0, bodyArr.length);
      score += Math.floor(2000/speed);
      document.getElementById("score").innerHTML = score;
    } else {
      bodyArr = bodyArr.slice(0, bodyArr.length-1);
    }
  }

  var checkLost = function () {
    var segmentIndex = 0;
    bodyArr.forEach((segment) => {
      var checkIndex = 0;
      bodyArr.forEach((check) => {
        if (segment[0] === check[0] && segment[1] === check[1] && segmentIndex !== checkIndex) {
          alert('GAME OVER');
          location.reload();
        }
        checkIndex++;
      });
      segmentIndex++;
    });
  }

  var checkWin = function () {
    if (bodyArr.length === gameHeight*gameWidth) {
      alert('YOU WON!');
    }
  }

  var nextFrame = setInterval(() => {
    moveSnake();
    checkEaten();
    checkLost();
    checkWin();
    render()
  }, speed)

  </script>

  <style type="text/css">
    canvas { border: 1px solid black; }
  </style>
</body>
</html>
