<html>
<body>
  <canvas id="game" width="300" height="200"></canvas>
  <script>
  //draw board
  var canvas = document.getElementById('game');
  var ctx = canvas.getContext('2d');

  var heightPixels = 200;
  var widthPixels = 300;
  var segmentHeight = 10;
  var segmentWidth = 10;
  var gameHeight = heightPixels/segmentHeight;
  var gameWidth = widthPixels/segmentWidth;


  var leftPad = (() => {
  	var arr = [];
  	for(var x= 0; x<=5*segmentHeight; x+=10) {
  		arr.push([0, heightPixels/2+x, 10, 10]);
    }
  	return arr;
  })();

  var rightPad = (() => {
    var arr = [];
  	for(var x= 0; x<=gameHeight*segmentHeight; x+=10) {
  		arr.push([widthPixels-1*segmentWidth, x, 10, 10]);
    }
  	return arr;
  })();

  var player = leftPad;
  var ball = [100, 100, 10, 10];
  var ballVelocity = [-1, 0];
  var playerMomentum = [1000, 0];

  var moveBall = function(){
    checkCollision()
    if(ball[1] <= 0 || ball[1] >= heightPixels - 10) {
      ballVelocity[1] = -1*ballVelocity[1];
    }
    ball = [ball[0] + ballVelocity[0], ball[1] + ballVelocity[1] , 10, 10];
  }


  var changeDirection = function(e){
    if (e.key === 'ArrowUp' && player[0][1] !== 0) {
      player = player.map((segment) => {
        segment[1] += -segmentHeight;
        playerMomentum = [Date.now(), 1];
        return segment;
      });
    } else if (e.key === 'ArrowDown' && player[player.length-1][1] < heightPixels-10) {
      player = player.map((segment) => {
        segment[1] += segmentHeight;
        playerMomentum = -1*Date.now()
        playerMomentum = [Date.now(), -1]
        return segment;
      })
    }
  }

  window.addEventListener('keydown', changeDirection, false);

  var checkCollision = function(){
    var leftTopSegment = leftPad[0][1];
    var leftBottomSegment = leftPad[leftPad.length-1][1];
    var rightTopSegment = rightPad[0][1];
    var rightBottomSegment = rightPad[rightPad.length-1][1];

    if(ball[0] - leftPad[0][0] <= 10 && ball[1] <= leftBottomSegment && ball[1] >= leftTopSegment) {
      checkMomentum();
      ballVelocity[0] = -1*ballVelocity[0];
    }

    if(rightPad[0][0] - ball[0] <= 10 && ball[1] <= rightBottomSegment && ball[1] >= rightTopSegment) {
      // checkMomentum();
      ballVelocity[0] = -1*ballVelocity[0];
    }
  }

  var checkWin = function () {
    if (ball[0] < 0) {
      alert('you lose');
      location.reload();
    } else if (ball[0] > widthPixels) {
      alert('you win');
      location.reload();
    }
  }


  var checkMomentum = function() {
    var padMomentum = Date.now()-playerMomentum[0];
    if(padMomentum < 1000) {
      if (playerMomentum[1] > 0) {
        ballVelocity = [ballVelocity[0], -50/padMomentum + ballVelocity[1]];
      } else {
        ballVelocity = [ballVelocity[0], 50/padMomentum + ballVelocity[1]];
      }
    }
  }

  var render = function () {
    ctx.clearRect(0, 0, widthPixels, heightPixels);
    leftPad.forEach((segment) => {ctx.fillRect(...segment)});
    rightPad.forEach((segment) => {ctx.fillRect(...segment)});
    ctx.fillRect(...ball);
  }


  var nextFrame = setInterval(() => {
    moveBall();
    render()
    checkWin();
  }, 10)

  </script>

  <style type="text/css">
    canvas { border: 1px solid black; }
  </style>
</body>
</html>
